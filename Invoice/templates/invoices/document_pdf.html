{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>{% if document.document_type == 'quotation' %}Quotation{% else %}Invoice{% endif %} {{ document.reference }}</title>
    <style type="text/css">
        @page {
            size: A4;
            margin: 10mm 12mm 10mm 12mm;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Helvetica, Arial, sans-serif;
            font-size: 9px;
            color: #212529;
            line-height: 1.3;
        }
        
        table {
            border-collapse: collapse;
        }
        
        /* Header */
        .header-table {
            width: 100%;
            margin-bottom: 10px;
        }
        
        .header-table td {
            vertical-align: middle;
        }
        
        .logo-cell img {
            width: 100px;
            height: auto;
        }
        
        .title-cell {
            text-align: right;
        }
        
        .title-cell h1 {
            font-size: 28px;
            color: #1e73be;
            font-weight: 600;
            margin: 0;
            letter-spacing: -0.5px;
        }
        
        /* Info Boxes */
        .info-table {
            width: 100%;
            margin-bottom: 10px;
        }
        
        .info-box {
            border: 1px solid #2c3e50;
            vertical-align: top;
        }
        
        .info-box-header {
            background-color: #2c3e50;
            color: white;
            padding: 5px 8px;
            font-size: 9px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .info-box-content {
            padding: 6px 8px;
            font-size: 8px;
            line-height: 1.4;
        }
        
        .info-box-content strong {
            font-weight: 600;
            font-size: 9px;
        }
        
        /* Reference Section */
        .ref-table {
            width: 100%;
            margin-bottom: 8px;
            font-size: 9px;
        }
        
        .ref-table td {
            padding: 2px 0;
        }
        
        .ref-label {
            font-weight: 600;
            width: 100px;
        }
        
        /* Items Table - EXACT MATCH */
        .items-table {
            width: 100%;
            border: 1px solid #2c3e50;
            margin-bottom: 8px;
        }
        
        .items-table th {
            background-color: #ecf0f1;
            border: 1px solid #2c3e50;
            padding: 5px 4px;
            text-align: center;
            font-size: 8px;
            font-weight: 600;
            text-transform: uppercase;
            color: #2c3e50;
        }
        
        .items-table td {
            border: 1px solid #bdc3c7;
            padding: 5px 4px;
            font-size: 8px;
            vertical-align: middle;
        }
        
        .text-center {
            text-align: center;
        }
        
        .text-right {
            text-align: right;
            font-weight: 500;
        }
        
        /* Totals - EXACT MATCH to preview */
        .totals-table-wrapper {
            width: 100%;
            margin-bottom: 8px;
        }
        
        .totals-table {
            width: 280px;
            border: 1px solid #2c3e50;
            float: right;
        }
        
        .totals-row {
            width: 100%;
        }
        
        .totals-row td {
            padding: 5px 10px;
            font-size: 9px;
            border-bottom: 1px solid #bdc3c7;
        }
        
        .totals-row td.label {
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .totals-row td.value {
            text-align: right;
            font-weight: 600;
        }
        
        .subtotal-row td {
            background-color: #f8f9fa;
        }
        
        .total-row td {
            background-color: #2c3e50;
            color: white;
            font-size: 10px;
            font-weight: 700;
            padding: 6px 10px;
            border-bottom: none;
        }
        
        .clear {
            clear: both;
        }
        
        /* Quotation Details */
        .quotation-details {
            margin-bottom: 8px;
            font-size: 8px;
            line-height: 1.4;
        }
        
        .detail-label {
            font-style: italic;
            font-weight: 600;
        }
        
        .detail-value {
            margin-left: 15px;
        }
        
        /* Value Statement */
        .value-statement {
            text-align: center;
            font-size: 9px;
            margin-bottom: 8px;
            padding: 5px;
            background-color: #f8f9fa;
            border-left: 2px solid #1e73be;
        }
        
        /* Bank Info */
        .bank-info {
            border: 1px solid #2c3e50;
            padding: 6px;
            text-align: center;
            margin-bottom: 10px;
            font-size: 8px;
            line-height: 1.4;
            background-color: #fcfcfc;
        }
        
        .bank-title {
            font-weight: 600;
            font-size: 9px;
            margin-bottom: 3px;
        }
        
        /* Signature Section */
        .signature-section {
            text-align: center;
            margin-bottom: 8px;
        }
        
        .dept-name {
            font-size: 9px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .stamp-container {
            margin: 5px auto;
        }
        
        .stamp-container img {
            width: 100px;
            height: auto;
        }
        
        .signature-line {
            width: 140px;
            border-top: 1px solid #2c3e50;
            margin: 3px auto;
        }
        
        .signature-label {
            font-style: italic;
            font-size: 8px;
            color: #666;
        }
        
        /* Footer */
        .footer {
            padding-top: 8px;
            border-top: 1px solid #ecf0f1;
        }
        
        .contact-info {
            text-align: center;
            font-size: 8px;
            color: #666;
        }
        
        .contact-info a {
            color: #1e73be;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <table class="header-table">
        <tr>
            <td class="logo-cell" style="width: 50%;">
                <img src="{{ logo_path }}" alt="{{ company.name }}">
            </td>
            <td class="title-cell" style="width: 50%;">
                <h1>{% if document.document_type == 'quotation' %}Quotation{% else %}Invoice{% endif %}</h1>
            </td>
        </tr>
    </table>
    
    <!-- Info Boxes -->
    <table class="info-table">
        <tr>
            <td class="info-box" style="width: 48%;">
                <div class="info-box-header">{{ company.name }}</div>
                <div class="info-box-content">
                    {{ company.address }}<br>
                    {{ company.city }} - {{ company.country }}<br>
                    NIF: {{ company.nif }}<br>
                    Tel: {{ company.phone }}<br>
                    E-mail: {{ company.email }}
                </div>
            </td>
            <td style="width: 4%;"></td>
            <td class="info-box" style="width: 48%;">
                <div class="info-box-header">Customer Information</div>
                <div class="info-box-content">
                    <strong>{{ document.customer_name }}</strong><br>
                    {% if document.customer_location %}{{ document.customer_location }}<br>{% endif %}
                    {% if document.customer_phone %}TEL: {{ document.customer_phone }}{% endif %}
                </div>
            </td>
        </tr>
    </table>
    
    <!-- Reference and Date -->
    <table class="ref-table">
        <tr>
            <td class="ref-label">Reference:</td>
            <td style="width: 35%;">{{ document.reference }}</td>
            <td class="ref-label">Date:</td>
            <td>{{ document.date|date:"M d, Y" }}</td>
        </tr>
        {% if document.document_type == 'invoice' and document.customer_po_ref %}
        <tr>
            <td class="ref-label">Customer PO Ref.:</td>
            <td colspan="3">{{ document.customer_po_ref }}</td>
        </tr>
        {% endif %}
    </table>
    
    <!-- Items Table -->
    <table class="items-table">
        <thead>
            <tr>
                <th style="width: 35px;">Item</th>
                <th>Description</th>
                <th style="width: 50px;">Unit</th>
                <th style="width: 40px;">QTY</th>
                <th style="width: 85px;">Unit Price<br>({{ document.currency }})</th>
                <th style="width: 85px;">Total Price<br>({{ document.currency }})</th>
            </tr>
        </thead>
        <tbody>
            {% for item in document.items.all %}
            <tr>
                <td class="text-center">{{ item.item_number }}</td>
                <td>{{ item.description }}</td>
                <td class="text-center">{{ item.unit }}</td>
                <td class="text-center">{{ item.quantity }}</td>
                <td class="text-right">{{ document.currency }} {{ item.unit_price|floatformat:2 }}</td>
                <td class="text-right">{{ document.currency }} {{ item.total_price|floatformat:2 }}</td>
            </tr>
            {% endfor %}
            {% if document.items.count < 2 %}
            {% for i in "12"|make_list %}
            {% if forloop.counter|add:document.items.count <= 2 %}
            <tr>
                <td class="text-center">&nbsp;&nbsp;&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td class="text-right"> - MRU</td>
            </tr>
            {% endif %}
            {% endfor %}
            {% endif %}
        </tbody>
    </table>
    
    <!-- Totals Section - RIGHT ALIGNED like preview -->
    <table style="width: 100%; margin-bottom: 8px;">
        <tr>
            <td style="width: 55%;"></td>
            <td style="width: 45%;">
                <table class="totals-table" style="width: 100%; border: 1px solid #2c3e50;">
                    <tr class="subtotal-row">
                        <td class="label" style="background-color: #f8f9fa; padding: 5px 10px; font-weight: 600; text-transform: uppercase; font-size: 9px; border-bottom: 1px solid #bdc3c7;">Total {{ document.currency }}</td>
                        <td class="value" style="background-color: #f8f9fa; padding: 5px 10px; text-align: right; font-weight: 600; font-size: 9px; border-bottom: 1px solid #bdc3c7;">{{ document.currency }} {{ document.subtotal|floatformat:2 }}</td>
                    </tr>
                    <tr>
                        <td class="label" style="padding: 5px 10px; font-weight: 600; text-transform: uppercase; font-size: 9px; border-bottom: 1px solid #bdc3c7;">TVA {{ document.tva_rate }}%</td>
                        <td class="value" style="padding: 5px 10px; text-align: right; font-weight: 600; font-size: 9px; border-bottom: 1px solid #bdc3c7;">{{ document.currency }} {{ document.tva_amount|floatformat:2 }}</td>
                    </tr>
                    <tr class="total-row">
                        <td style="background-color: #2c3e50; color: white; padding: 6px 10px; font-weight: 700; text-transform: uppercase; font-size: 10px;">Total {% if document.document_type == 'quotation' %}Quotation{% else %}Invoice{% endif %} {{ document.currency }}</td>
                        <td style="background-color: #2c3e50; color: white; padding: 6px 10px; text-align: right; font-weight: 700; font-size: 10px;">{{ document.currency }} {{ document.total|floatformat:2 }}</td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
    
    <!-- Quotation-specific fields -->
    {% if document.document_type == 'quotation' %}
    <div class="quotation-details">
        {% if document.work_delivery %}
        <div style="margin-bottom: 4px;">
            <span class="detail-label">Work Delivery:</span>
            <span class="detail-value">{{ document.work_delivery }}</span>
        </div>
        {% endif %}
        {% if document.payment_terms %}
        <div>
            <span class="detail-label">Payment Term:</span>
            <span class="detail-value">{{ document.payment_terms }}</span>
        </div>
        {% endif %}
    </div>
    {% endif %}
    
    <!-- Invoice value statement -->
    {% if document.document_type == 'invoice' %}
    <div class="value-statement">
        The value of this invoice is as follow: <strong>{{ document.amount_in_words|default:"" }}</strong>
    </div>
    {% endif %}
    
    <!-- Bank Information -->
    <div class="bank-info">
        <div class="bank-title">{{ company.name }}</div>
        Account Number: {{ company.account_number }} - {{ company.bank_name }}<br>
        {{ company.bank_code }}
    </div>
    
    <!-- Signature Section -->
    <div class="signature-section">
        <p class="dept-name">{{ company.department|default:"Commercial Dept" }}</p>
        <div class="stamp-container">
            <img src="{{ stamp_path }}" alt="Company Stamp">
        </div>
        <div class="signature-line"></div>
        <p class="signature-label">Signature &amp; Stamp</p>
    </div>
    
    <!-- Footer -->
    <div class="footer">
        <div class="contact-info">
            If you have any questions about this {% if document.document_type == 'quotation' %}offer{% else %}invoice{% endif %}, please contact
            <a href="mailto:{{ company.email }}">{{ company.email }}</a>
        </div>
    </div>
</body>
</html>